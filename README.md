# timsMSI

This document is the reproducible code for timsToF MSI workflow. To access standalone timsToF MSI workflow, please install rmwf package from GitHub and use rmarkdown::draft("test.Rmd", template = "MSI", package = "rmwf") to create a reproducible workflow document for your own studies. Such workflow is also available through xcmsrocker project.

# Install the packages needed for this workflow

We use renv package to restore the packages needed for this workflow.

```r
install.packages('renv')
renv::restore()
```

# Files

workflow.Rmd: the reproducible documents for the paper with all of the details. Some of the files in this repo is generated by this document.

The following files are required to run this workflow:

lipidall.csv: lipid m/z-ccs annotation database from Metlin and Lipid atlas.

metaall.csv: metabolomics m/z-ccs annotation database from Metlin.

ccs_to_one_over_k0.cpp: script to convert ccs value to 1/k0 with required dll/so file.

one_over_k0_to_css.cpp: script to convert 1/k0 to ccs value with required dll/so file.

peak_finder.cpp: script to find local max peaks on m/z-ccs 2D plane.

peakalign.cpp: script to extract peaks with reference peaks list across pixels.

# Usage

- Line 26: Change `path = 'PATH_TO_RAW.d'` to the .D folder path of raw data. If your data size must be less that the 10 times of your memory size. For example, if your .D folder is 20GB, you need 200GB memory to run this workflow. It's better to run this workflow on HPC or Cloud.

- Line 28: accept Bruker's lisence to download so/dll file  `accept_Bruker_EULA_and_on_Windows_or_Linux = TRUE`

- (optional) Line 41: set the x and y range for the pixels to be extracted

- Run `rmarkdown::render('workflow.Rmd')` or click knit button within RStudio to run the workflow. Or you could run each code chunk according to the description/comments.


